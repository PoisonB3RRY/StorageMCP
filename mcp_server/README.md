# Weather MCP Server

A Model Context Protocol (MCP) server for weather forecasting and alerts, built with FastAPI.

## Overview

This MCP server provides weather-related functionality through HTTP endpoints, allowing MCP clients to:

- Get weather forecasts for specific locations (latitude/longitude)
- Get weather alerts for US states
- Discover available tools and their parameters

## Features

- **RESTful API**: Built with FastAPI for high performance and automatic API documentation
- **Async Support**: Non-blocking I/O for handling multiple requests efficiently
- **Configuration**: Environment-based configuration with Pydantic settings
- **Logging**: Structured logging with file and console output
- **CORS Support**: Configurable CORS settings for web client integration
- **Health Checks**: Built-in health check endpoint for monitoring
- **Tool Discovery**: Dynamic tool listing for MCP client integration

## Installation

### Prerequisites

- Python 3.10+
- pip or uv

### Using pip

```bash
cd mcp_server
pip install -r requirements.txt
```

### Using uv (recommended)

```bash
cd mcp_server
uv pip install -r requirements.txt
```

## Configuration

Copy the example configuration file and modify as needed:

```bash
cp .env.example .env
```

Edit the `.env` file to configure:

- Server host and port
- Debug mode
- Weather API settings
- Logging configuration
- CORS settings

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `MCP_HOST` | `0.0.0.0` | Server host |
| `MCP_PORT` | `8000` | Server port |
| `MCP_DEBUG` | `false` | Enable debug mode |
| `MCP_WEATHER_API_BASE_URL` | `https://api.weather.gov` | Weather API base URL |
| `MCP_USER_AGENT` | `WeatherMCP/0.1.0` | User agent for API requests |
| `MCP_LOG_LEVEL` | `INFO` | Logging level |
| `MCP_LOG_FILE` | `mcp_server.log` | Log file path |

## Usage

### Starting the Server

```bash
# Using the main module
python -m mcp_server.src.main

# Or directly
python mcp_server/src/main.py

# With custom host and port
python mcp_server/src/main.py --host 127.0.0.1 --port 9000
```

### Docker

Build and run with Docker:

```bash
# Build the image
docker build -t weather-mcp-server .

# Run the container
docker run -p 8000:8000 weather-mcp-server
```

## API Endpoints

### Health Check

```
GET /health
```

Returns server health status.

### Tool Discovery

```
GET /tools
```

Returns available tools and their parameters for MCP clients.

### Weather Forecast

```
POST /forecast
```

Get weather forecast for a location.

**Request Body:**
```json
{
  "latitude": 37.7749,
  "longitude": -122.4194
}
```

### Weather Alerts

```
POST /alerts
```

Get weather alerts for a US state.

**Request Body:**
```json
{
  "state": "CA"
}
```

## Development

### Running Tests

```bash
cd mcp_server
pytest tests/
```

### Code Formatting

```bash
# Using black
black src/ tests/

# Using ruff
ruff check src/ tests/
ruff format src/ tests/
```

### API Documentation

The API documentation is automatically generated by FastAPI and available at:

- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

## Architecture

```
mcp_server/
├── src/
│   ├── __init__.py
│   ├── config.py      # Configuration management
│   ├── main.py        # Application entry point
│   └── server.py      # FastAPI application and endpoints
├── tests/
│   ├── __init__.py
│   └── test_server.py # Unit tests
├── .env.example       # Environment configuration template
├── pyproject.toml     # Project dependencies and configuration
└── README.md          # This file
```

## Integration with MCP Clients

This server is designed to work with MCP clients that can:

1. Discover available tools via the `/tools` endpoint
2. Make HTTP requests to the provided endpoints
3. Handle the JSON responses

### Example MCP Client Integration

```python
import requests

# Discover tools
tools_response = requests.get("http://localhost:8000/tools")
tools = tools_response.json()["tools"]

# Use a tool
forecast_response = requests.post(
    "http://localhost:8000/forecast",
    json={"latitude": 37.7749, "longitude": -122.4194}
)
forecast = forecast_response.json()
```

## Monitoring

The server provides several endpoints for monitoring:

- **Health Check**: `/health` - Server status
- **Metrics**: (Future enhancement) - Performance metrics
- **Logs**: Structured logging to file and console

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Run the test suite
6. Submit a pull request

## License

This project is licensed under the MIT License.

## Support

For issues and questions:

- Create a GitHub issue
- Check the API documentation
- Review the test cases for usage examples